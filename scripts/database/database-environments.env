# ===========================================
# SaaS Control Deck 三环境数据库连接配置
# ===========================================
# 用途: 为各微服务提供数据库连接配置
# 使用: 根据环境选择对应的配置块
# ===========================================

# ===========================================
# 数据库服务器信息
# ===========================================
DB_HOST=47.79.87.199
DB_PORT=5432

# ===========================================
# 开发环境数据库配置 (Development)
# ===========================================
# 适用于: Firebase Studio开发环境
# 特点: 允许外部连接，支持schema修改

# Backend Pro1 开发环境 (端口 8000-8002)
DEV_PRO1_DB_NAME=saascontrol_dev_pro1
DEV_PRO1_DB_USER=saasctl_dev_pro1_user
DEV_PRO1_DB_PASSWORD=dev_pro1_secure_2025!
DEV_PRO1_DB_URL=postgresql://saasctl_dev_pro1_user:dev_pro1_secure_2025!@47.79.87.199:5432/saascontrol_dev_pro1

# Backend Pro2 开发环境 (端口 8100-8102)
DEV_PRO2_DB_NAME=saascontrol_dev_pro2
DEV_PRO2_DB_USER=saasctl_dev_pro2_user
DEV_PRO2_DB_PASSWORD=dev_pro2_secure_2025!
DEV_PRO2_DB_URL=postgresql://saasctl_dev_pro2_user:dev_pro2_secure_2025!@47.79.87.199:5432/saascontrol_dev_pro2

# ===========================================
# 测试环境数据库配置 (Staging)
# ===========================================
# 适用于: CI/CD自动化测试
# 特点: 限制权限，支持数据重置

# Backend Pro1 测试环境
STAGE_PRO1_DB_NAME=saascontrol_stage_pro1
STAGE_PRO1_DB_USER=saasctl_stage_pro1_user
STAGE_PRO1_DB_PASSWORD=stage_pro1_secure_2025!
STAGE_PRO1_DB_URL=postgresql://saasctl_stage_pro1_user:stage_pro1_secure_2025!@47.79.87.199:5432/saascontrol_stage_pro1

# Backend Pro2 测试环境
STAGE_PRO2_DB_NAME=saascontrol_stage_pro2
STAGE_PRO2_DB_USER=saasctl_stage_pro2_user
STAGE_PRO2_DB_PASSWORD=stage_pro2_secure_2025!
STAGE_PRO2_DB_URL=postgresql://saasctl_stage_pro2_user:stage_pro2_secure_2025!@47.79.87.199:5432/saascontrol_stage_pro2

# ===========================================
# 生产环境数据库配置 (Production)
# ===========================================
# 适用于: 正式生产环境
# 特点: 严格权限，完整监控和备份

# Backend Pro1 生产环境
PROD_PRO1_DB_NAME=saascontrol_prod_pro1
PROD_PRO1_DB_USER=saasctl_prod_pro1_user
PROD_PRO1_DB_PASSWORD=prod_pro1_ULTRA_secure_2025#$%
PROD_PRO1_DB_URL=postgresql://saasctl_prod_pro1_user:prod_pro1_ULTRA_secure_2025%23%24%25@47.79.87.199:5432/saascontrol_prod_pro1

# Backend Pro2 生产环境
PROD_PRO2_DB_NAME=saascontrol_prod_pro2
PROD_PRO2_DB_USER=saasctl_prod_pro2_user
PROD_PRO2_DB_PASSWORD=prod_pro2_ULTRA_secure_2025#$%
PROD_PRO2_DB_URL=postgresql://saasctl_prod_pro2_user:prod_pro2_ULTRA_secure_2025%23%24%25@47.79.87.199:5432/saascontrol_prod_pro2

# ===========================================
# 连接池配置
# ===========================================

# 开发环境连接池配置
DEV_DB_POOL_SIZE=5
DEV_DB_MAX_OVERFLOW=10
DEV_DB_POOL_TIMEOUT=30
DEV_DB_POOL_RECYCLE=3600

# 测试环境连接池配置
STAGE_DB_POOL_SIZE=10
STAGE_DB_MAX_OVERFLOW=20
STAGE_DB_POOL_TIMEOUT=30
STAGE_DB_POOL_RECYCLE=3600

# 生产环境连接池配置
PROD_DB_POOL_SIZE=20
PROD_DB_MAX_OVERFLOW=30
PROD_DB_POOL_TIMEOUT=30
PROD_DB_POOL_RECYCLE=3600

# ===========================================
# SSL/TLS 配置
# ===========================================
DB_SSL_MODE=prefer
DB_SSL_CERT_PATH=/path/to/client-cert.pem
DB_SSL_KEY_PATH=/path/to/client-key.pem
DB_SSL_CA_PATH=/path/to/ca-cert.pem

# ===========================================
# 超时和重试配置
# ===========================================
DB_CONNECT_TIMEOUT=30
DB_COMMAND_TIMEOUT=60
DB_MAX_RETRIES=3
DB_RETRY_DELAY=1

# ===========================================
# 监控和日志配置
# ===========================================
DB_LOG_QUERIES=false
DB_LOG_SLOW_QUERIES=true
DB_SLOW_QUERY_THRESHOLD=5000
DB_ENABLE_METRICS=true
DB_METRICS_INTERVAL=60

# ===========================================
# 环境特定配置覆盖
# ===========================================

# 如果是开发环境，启用详细日志
# DEV_DB_LOG_QUERIES=true
# DEV_DB_SLOW_QUERY_THRESHOLD=1000

# 如果是生产环境，禁用详细日志
# PROD_DB_LOG_QUERIES=false
# PROD_DB_SLOW_QUERY_THRESHOLD=10000

# ===========================================
# 微服务端口映射配置
# ===========================================

# Backend Pro1 服务端口 (8000-8002)
BACKEND_PRO1_API_GATEWAY_PORT=8000
BACKEND_PRO1_DATA_SERVICE_PORT=8001
BACKEND_PRO1_AI_SERVICE_PORT=8002

# Backend Pro2 服务端口 (8100-8102)
BACKEND_PRO2_API_GATEWAY_PORT=8100
BACKEND_PRO2_DATA_SERVICE_PORT=8101
BACKEND_PRO2_AI_SERVICE_PORT=8102

# ===========================================
# 数据库健康检查配置
# ===========================================
DB_HEALTH_CHECK_INTERVAL=30
DB_HEALTH_CHECK_TIMEOUT=5
DB_HEALTH_CHECK_RETRIES=3
DB_HEALTH_CHECK_QUERY=SELECT 1

# ===========================================
# 备份和恢复配置
# ===========================================
DB_BACKUP_ENABLED=true
DB_BACKUP_SCHEDULE=0 2 * * *  # 每天凌晨2点
DB_BACKUP_RETENTION_DAYS=30
DB_BACKUP_LOCATION=/backup/saascontrol
DB_BACKUP_COMPRESSION=gzip

# ===========================================
# 开发者调试配置
# ===========================================
# 仅在开发环境中使用这些配置

# 启用SQL查询日志记录
DEBUG_SQL_QUERIES=false

# 启用数据库性能分析
DEBUG_PERFORMANCE_PROFILING=false

# 启用详细错误信息
DEBUG_VERBOSE_ERRORS=true

# ===========================================
# 注意事项和使用说明
# ===========================================

# 1. 密码包含特殊字符，在URL中需要进行编码:
#    # -> %23
#    $ -> %24  
#    % -> %25

# 2. 环境变量使用优先级:
#    1. 系统环境变量
#    2. 本配置文件
#    3. 应用默认值

# 3. 生产环境安全提醒:
#    - 生产密码应存储在安全的密钥管理系统中
#    - 定期轮换数据库密码
#    - 启用SSL/TLS连接
#    - 限制网络访问

# 4. 微服务配置使用示例:
#    # Python FastAPI
#    DATABASE_URL = os.getenv('DEV_PRO1_DB_URL')
#    
#    # Node.js
#    const dbUrl = process.env.DEV_PRO1_DB_URL;

# 5. 连接池配置建议:
#    开发环境: 5-15个连接
#    测试环境: 10-30个连接  
#    生产环境: 20-50个连接

# 6. 监控和告警:
#    - 设置连接数告警阈值
#    - 监控慢查询
#    - 跟踪数据库性能指标
#    - 定期检查连接池状态